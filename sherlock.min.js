/*!
 * Sherlock
 * Copyright (c) 2012 Tabule, Inc.
 * Version 1.0
 */
var Sherlock=(function(){var d={rangeSplitters:/(\bto\b|\-|\b(?:un)?till?\b|\bthrough|and\b)/g,months:"\\b(jan(?:uary)?|feb(?:ruary)?|mar(?:ch)?|apr(?:il)?|may|jun(?:e)?|jul(?:y)?|aug(?:ust)?|sep(?:tember)?|oct(?:ober)?|nov(?:ember)?|dec(?:ember)?)\\b",days:"\\b(?:(?:(?:on )?the )(?=\\d\\d?(?:st|nd|rd|th)))?([1-2]\\d|3[0-1]|0?[1-9])(?:st|nd|rd|th)?(?:,|\\b)",shortForm:/\b(0?[1-9]|1[0-2])(?:\/|\.)([1-2]\d|3[0-1]|0?[1-9])(?:(?:\/|\.)(?:20)?1\d)?\b/,weekdays:/(next (?:week (?:on )?)?)?\b(sun|mon|tue(?:s)?|wed(?:nes)?|thurs|fri|sat(?:ur)?)(?:day)?\b/,relativeDate:/\b(next (?:week|month)|tom(?:orrow)?|tod(?:ay)?|day after tom(?:orrow)?)\b/,inRelativeDate:/\b(\d{1,2}|a) (day|week|month)s?\b/,inRelativeTime:/\b(\d{1,2}|a|an) (hour|min(?:ute)?)s?\b/,midtime:/(?:@ ?)?\b(?:at )?(noon|midnight)\b/,militaryTime:/\b(?:([0-2]\d):?([0-5]\d))(?! ?[ap]\.?m?\.?)\b/,explicitTime:/(?:@ ?)?\b(?:at |from )?(1[0-2]|[1-9])(?::([0-5]\d))? ?([ap]\.?m?\.?)?(?:o'clock)?\b/,fillerWords:/ (from|is|at|on|for|in|(?:un)?till?)\b/},c=null,b=function(){if(c){return new Date(c.getTime());
}else{return new Date();}},h=function(o,m,l){var k={},i=false,j=false,n=e.strToNum(o);if(i=g(n,m,l)){o=o.replace(new RegExp(e.numToStr(i)),"");}if(j=a(n,m,l)){o=o.replace(new RegExp(e.numToStr(j)),"");
}k.eventTitle=o.split(d.fillerWords)[0].trim();k.isAllDay=!!(i&&!j);k.isValidDate=!!(i||j||o.match(/\bnow\b/));return k;},a=function(o,n,m){var j;if(j=o.match(d.inRelativeTime)){if(isNaN(j[1])){j[1]=1;
}switch(j[2]){case"hour":n.setHours(n.getHours()+parseInt(j[1]));return j[0];case"min":n.setMinutes(n.getMinutes()+parseInt(j[1]));return j[0];case"minute":n.setMinutes(n.getMinutes()+parseInt(j[1]));
return j[0];default:return false;}}else{if(j=o.match(d.midtime)){switch(j[1]){case"noon":n.setHours(12,0,0);return j[0];case"midnight":n.setHours(0,0,0);
return j[0];default:return false;}}else{if(j=o.match(d.militaryTime)){n.setHours(j[1],j[2],0);return j[0];}else{if(j=o.match(new RegExp(d.explicitTime.source,"g"))){j=j.sort(function(q,p){return p.length-q.length;
})[0];if(j.length<=2&&o.trim().length>2){return false;}j=j.match(d.explicitTime);var i=parseInt(j[1]),l=j[2]||0,k=j[3];if(k){if(k.indexOf("p")===0&&i!=12){i+=12;
}else{if(k.indexOf("a")===0&&i==12){i=0;}}}else{if(i<12&&(i<7||i<n.getHours())){i+=12;}}n.setHours(i,l,0);return j[0];}else{return false;}}}}},g=function(o,n,l){var k;
if(k=o.match(d.monthDay)){n.setMonth(e.changeMonth(k[1]),k[2]);return k[0];}else{if(k=o.match(d.dayMonth)){n.setMonth(e.changeMonth(k[2]),k[1]);return k[0];
}else{if(k=o.match(d.weekdays)){switch(k[2].substr(0,3)){case"sun":e.changeDay(n,0,k[1]);return k[0];case"mon":e.changeDay(n,1,k[1]);return k[0];case"tue":e.changeDay(n,2,k[1]);
return k[0];case"wed":e.changeDay(n,3,k[1]);return k[0];case"thu":e.changeDay(n,4,k[1]);return k[0];case"fri":e.changeDay(n,5,k[1]);return k[0];case"sat":e.changeDay(n,6,k[1]);
return k[0];default:return false;}}else{if(k=o.match(d.relativeDate)){var j=b();switch(k[1]){case"next week":n.setMonth(j.getMonth(),j.getDate()+7);return k[0];
case"next month":n.setMonth(n.getMonth()+1);return k[0];case"tom":n.setMonth(j.getMonth(),j.getDate()+1);return k[0];case"tomorrow":n.setMonth(j.getMonth(),j.getDate()+1);
return k[0];case"day after tomorrow":n.setMonth(j.getMonth(),j.getDate()+2);return k[0];case"day after tom":n.setMonth(j.getMonth(),j.getDate()+2);return k[0];
case"today":n.setMonth(j.getMonth(),j.getDate());return k[0];case"tod":n.setMonth(j.getMonth(),j.getDate());return k[0];default:return false;}}else{if(k=o.match(d.inRelativeDate)){if(isNaN(k[1])){k[1]=1;
}switch(k[2]){case"day":n.setDate(n.getDate()+parseInt(k[1]));return k[0];case"week":n.setDate(n.getDate()+parseInt(k[1])*7);return k[0];case"month":n.setMonth(n.getMonth()+parseInt(k[1]));
return k[0];default:return false;}}else{if(k=o.match(d.shortForm)){n.setMonth(k[1]-1,k[2]);return k[0];}else{if(k=o.match(new RegExp(d.days,"g"))){k=k.sort(function(q,p){return p.length-q.length;
})[0];if((k.indexOf("on")!==0&&!(k.indexOf("the")===0&&k.indexOf(",",k.length-1)!==-1)&&o.indexOf(k,o.length-k.length-1)===-1)||(!(l&&l.isAllDay)&&k.length<=2)){return false;
}k=k.match(d.daysOnly);var m=n.getMonth(),i=k[1];if(i<n.getDate()){m++;}n.setMonth(m,i);return k[0];}else{return false;}}}}}}}},f=function(l,i,k){var j=b();
if(i){if(l>i&&i>j&&e.isSameDay(l,i)&&e.isSameDay(l,j)){l.setDate(l.getDate()-1);}else{if(i<j){if(e.isSameDay(i,j)){if(!k){if(l<i&&e.isSameDay(l,j)){l.setDate(l.getDate()+1);
}i.setDate(i.getDate()+1);}}else{if(l<i){l.setFullYear(l.getFullYear()+1);}i.setFullYear(i.getFullYear()+1);}}}}else{if(l){if(l<j){if(e.isSameDay(l,j)){if(!k){l.setDate(l.getDate()+1);
}}else{l.setFullYear(l.getFullYear()+1);}}}}},e={changeMonth:function(i){return this.monthToInt[i.substr(0,3)];},changeDay:function(l,j,i){var k=7-l.getDay()+j;
if(k>7&&!i){k-=7;}l.setDate(l.getDate()+k);},escapeRegExp:function(i){return i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");},isSameDay:function(j,i){return j.getMonth()===i.getMonth()&&j.getDate()===i.getDate()&&j.getFullYear()===i.getFullYear();
},monthToInt:{jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11},wordsToInt:{one:1,first:1,two:2,second:2,three:3,third:3,four:4,fourth:4,five:5,fifth:5,six:6,sixth:6,seven:7,seventh:7,eight:8,eighth:8,nine:9,ninth:9,ten:10,tenth:10},intToWords:["one|first","two|second","three|third","four|fourth","five|fifth","six|sixth","seven|seventh","eight|eighth","nine|ninth","ten|tenth"],strToNum:function(i){return i.replace(d.digit,function(k){var j=e.wordsToInt[k];
if(k.indexOf("th",k.length-2)!==-1){j+="th";}else{if(k.indexOf("st",k.length-2)!==-1){j+="st";}else{if(k.indexOf("nd",k.length-2)!==-1){j+="nd";}else{if(k.indexOf("rd",k.length-2)!==-1){j+="rd";
}}}}return j;});},numToStr:function(i){return i.replace(/((?:[1-9]|10)(?:st|nd|rd|th)?)/g,function(j){return"(?:"+j+"|"+e.intToWords[parseInt(j)-1]+")";
});}};d.monthDay=new RegExp(d.months+" "+d.days);d.dayMonth=new RegExp(d.days+"(?: (?:day )?of)? "+d.months);d.daysOnly=new RegExp(d.days);d.digit=new RegExp("\\b("+e.intToWords.join("|")+")\\b","g");
return{parse:function(q){if(q===null){q="";}var o=b(),i=(typeof Watson!=="undefined")?Watson.preprocess(q):[q,{}],q=i[0],n=i[1],p=q.toLowerCase().split(d.rangeSplitters);
d.rangeSplitters.lastIndex=0;o.setMilliseconds(0);while(!n.startDate){if((i=h(p[0],o,null))!==null){if(i.isAllDay){o.setHours(0,0,0);}n.isAllDay=i.isAllDay;
n.eventTitle=i.eventTitle;n.startDate=i.isValidDate?o:null;}if(!n.startDate&&p.length>=3){var l=[p[0]+p[1]+p[2]];for(var j=3;j<p.length;j++){l.push(p[j]);
}p=l;}else{break;}}while(!n.endDate){if(p.length>1){o=new Date(o.getTime());if((i=h(p[2],o,n))!==null){if(n.isAllDay){o.setHours(0,0,0);}if(i.eventTitle.length>n.eventTitle.length){n.eventTitle=i.eventTitle;
}n.endDate=i.isValidDate?o:null;}}if(!n.endDate){if(p.length>=4){var l=[p[0],p[1],p[2]+p[3]+p[4]];for(var j=5;j<p.length;j++){l.push(p[j]);}p=l;}else{n.endDate=null;
break;}}}f(n.startDate,n.endDate,n.isAllDay);if(n.eventTitle){n.eventTitle=n.eventTitle.replace(/(?:^| )(?:\.|!|,|;)+/g,"");var m=q.match(new RegExp(e.escapeRegExp(n.eventTitle),"i"));
if(m){n.eventTitle=m[0].replace(/ +/g," ").trim();if(n.eventTitle==""){n.eventTitle=null;}}}else{n.eventTitle=null;}if(typeof Watson!=="undefined"){Watson.postprocess(n);
}return n;},_setNow:function(i){c=i;}};})();