/*!
 * Sherlock
 * Copyright (c) 2012 Tabule, Inc.
 * Version 1.0
 */
var Sherlock=(function(){var d={rangeSplitters:/(\bto\b|\-|\b(?:un)?till?\b|\bthrough|and\b)/g,months:"\\b(jan(?:uary)?|feb(?:ruary)?|mar(?:ch)?|apr(?:il)?|may|jun(?:e)?|jul(?:y)?|aug(?:ust)?|sep(?:tember)?|oct(?:ober)?|nov(?:ember)?|dec(?:ember)?)\\b",days:"\\b(?:(?:(?:on )?the )(?=\\d\\d?(?:st|nd|rd|th)))?([1-2]\\d|3[0-1]|0?[1-9])(?:st|nd|rd|th)?(?:,|\\b)",shortForm:/\b(0?[1-9]|1[0-2])(?:\/|\.)([1-2]\d|3[0-1]|0?[1-9])(?:(?:\/|\.)(?:20)?1\d)?\b/,weekdays:/(next (?:week (?:on )?)?)?\b(sun|mon|tue(?:s)?|wed(?:nes)?|thurs|fri|sat(?:ur)?)(?:day)?\b/,relativeDate:/\b(next (?:week|month)|tom(?:orrow)?|tod(?:ay)?|day after tom(?:orrow)?)\b/,inRelativeDate:/\b(\d{1,2}|a) (day|week|month)s?\b/,inRelativeTime:/\b(\d{1,2}|a|an) (hour|min(?:ute)?)s?\b/,midtime:/(?:@ ?)?\b(?:at )?(noon|midnight)\b/,militaryTime:/\b(?:([0-2]\d):?([0-5]\d))(?! ?[ap]\.?m?\.?)\b/,explicitTime:/(?:@ ?)?\b(?:at |from )?(1[0-2]|[1-9])(?::([0-5]\d))? ?([ap]\.?m?\.?)?\b/,hoursOnly:/^(1[0-2]|0?[1-9])$/,fillerWords:/ (from|is|at|on|for|in|(?:un)?till?)\b/},c=null,b=function(){if(c){return new Date(c.getTime());
}else{return new Date();}},g=function(n,l,k){var j={},h=false,i=false,m=e.strToNum(n);if(h=f(m,l,k)){n=n.replace(new RegExp(e.numToStr(h)),"");}if(i=a(m,l,k)){n=n.replace(new RegExp(e.numToStr(i)),"");
}j.eventTitle=n.split(d.fillerWords)[0].trim();j.isAllDay=!!(h&&!i);j.isValidDate=!!(h||i||n.match(/\bnow\b/));return j;},a=function(o,k,i){var n;if(n=o.match(d.inRelativeTime)){if(isNaN(n[1])){n[1]=1;
}switch(n[2]){case"hour":k.setHours(k.getHours()+parseInt(n[1]));break;case"min":k.setMinutes(k.getMinutes()+parseInt(n[1]));break;case"minute":k.setMinutes(k.getMinutes()+parseInt(n[1]));
break;default:return false;}}else{if(n=o.match(d.midtime)){switch(n[1]){case"noon":k.setHours(12,0,0);break;case"midnight":k.setHours(0,0,0);break;default:return false;
}}else{if(n=o.match(d.militaryTime)){k.setHours(n[1],n[2],0);}else{if(n=o.match(new RegExp(d.explicitTime.source,"g"))){n=n.sort(function(s,r){return r.length-s.length;
})[0];if(n.length<=2&&o.trim().length>2){return false;}n=n.match(d.explicitTime);var l=parseInt(n[1]),m=n[2]||0,j=n[3];if(j){if(j.indexOf("p")===0&&l!=12){l+=12;
}else{if(j.indexOf("a")===0&&l==12){l=0;}}}else{if(l<12&&(l<7||l<k.getHours())){l+=12;}}k.setHours(l,m,0);}else{return false;}}}}var h=b();if(k<h){k.setDate(k.getDate()+1);
}else{if(k>h&&i){if(i.startDate>k){if(o.length-n.length<2){k.setDate(k.getDate()+1);}else{i.startDate.setDate(i.startDate.getDate()-1);}}var q=new Date(k.getTime()),p=new Date(i.startDate.getTime());
if(!i.isAllDay&&p.getHours()<=h.getHours()&&p.getMinutes()<=h.getMinutes()&&p.getDate()-1===h.getDate()&&p.getMonth()===h.getMonth()&&p.getFullYear()===h.getFullYear()){p.setDate(p.getDate()-1);
q.setDate(q.getDate()-1);}if(p<h&&q>h){i.startDate=p;k.setDate(q.getDate());}}}return n[0];},f=function(m,j,i){var k,l,n;if(k=m.match(d.monthDay)){l=e.changeMonth(k[1]);
n=k[2];}else{if(k=m.match(d.dayMonth)){l=e.changeMonth(k[2]);n=k[1];}else{if(k=m.match(d.weekdays)){l=j.getMonth();switch(k[2].substr(0,3)){case"sun":n=e.changeDay(j,0,k[1]);
break;case"mon":n=e.changeDay(j,1,k[1]);break;case"tue":n=e.changeDay(j,2,k[1]);break;case"wed":n=e.changeDay(j,3,k[1]);break;case"thu":n=e.changeDay(j,4,k[1]);
break;case"fri":n=e.changeDay(j,5,k[1]);break;case"sat":n=e.changeDay(j,6,k[1]);break;default:return false;}}else{if(k=m.match(d.relativeDate)){var h=b();
switch(k[1]){case"next week":l=j.getMonth();n=j.getDate()+7;break;case"next month":l=j.getMonth()+1;n=j.getDate();break;case"tom":l=h.getMonth();n=h.getDate()+1;
break;case"tomorrow":l=h.getMonth();n=h.getDate()+1;break;case"day after tomorrow":l=h.getMonth();n=h.getDate()+2;break;case"day after tom":l=h.getMonth();
n=h.getDate()+2;break;case"today":l=h.getMonth();n=h.getDate();break;case"tod":l=h.getMonth();n=h.getDate();break;default:return false;}}else{if(k=m.match(d.inRelativeDate)){if(isNaN(k[1])){k[1]=1;
}switch(k[2]){case"day":l=j.getMonth();n=j.getDate()+parseInt(k[1]);break;case"week":l=j.getMonth();n=j.getDate()+parseInt(k[1])*7;break;case"month":l=j.getMonth()+parseInt(k[1]);
n=j.getDate();break;default:return false;}}else{if(k=m.match(d.shortForm)){l=k[1]-1;n=k[2];}else{if(k=m.match(new RegExp(d.days,"g"))){k=k.sort(function(r,q){return q.length-r.length;
})[0];if((k.indexOf("on")!==0&&!(k.indexOf("the")===0&&k.indexOf(",",k.length-1)!==-1)&&m.indexOf(k,m.length-k.length-1)===-1)||(!(i&&i.isAllDay)&&k.length<=2&&k.match(d.hoursOnly))){return false;
}k=k.match(d.daysOnly);l=j.getMonth();n=k[1];if(n<j.getDate()){l++;}}else{return false;}}}}}}}j.setMonth(l,n);var h=b();if(j<h&&!(j.getMonth()===h.getMonth()&&j.getDate()===h.getDate())){j.setFullYear(j.getFullYear()+1);
}else{if(j>h&&i){var p=new Date(j.getTime()),o=new Date(i.startDate.getTime());p.setFullYear(p.getFullYear()-1);o.setFullYear(o.getFullYear()-1);if((o<h&&p>h)||(o<h&&i.isAllDay&&p.getMonth()===h.getMonth()&&p.getDate()===h.getDate())){i.startDate=o;
j.setFullYear(j.getFullYear()-1);}}}return k[0];},e={changeMonth:function(h){switch(h.substr(0,3)){case"jan":return 0;case"feb":return 1;case"mar":return 2;
case"apr":return 3;case"may":return 4;case"jun":return 5;case"jul":return 6;case"aug":return 7;case"sep":return 8;case"oct":return 9;case"nov":return 10;
case"dec":return 11;default:return null;}},changeDay:function(k,i,h){var j=7-k.getDay()+i;if(j>7&&!h){j-=7;}return k.getDate()+j;},escapeRegExp:function(h){return h.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");
},wordsToInt:{one:1,first:1,two:2,second:2,three:3,third:3,four:4,fourth:4,five:5,fifth:5,six:6,sixth:6,seven:7,seventh:7,eight:8,eighth:8,nine:9,ninth:9,ten:10,tenth:10},intToWords:["one|first","two|second","three|third","four|fourth","five|fifth","six|sixth","seven|seventh","eight|eighth","nine|ninth","ten|tenth"],strToNum:function(h){return h.replace(d.digit,function(j){var i=e.wordsToInt[j];
if(j.indexOf("th",j.length-2)!==-1){i+="th";}else{if(j.indexOf("st",j.length-2)!==-1){i+="st";}else{if(j.indexOf("nd",j.length-2)!==-1){i+="nd";}else{if(j.indexOf("rd",j.length-2)!==-1){i+="rd";
}}}}return i;});},numToStr:function(h){return h.replace(/((?:[1-9]|10)(?:st|nd|rd|th)?)/g,function(i){return"(?:"+i+"|"+e.intToWords[parseInt(i)-1]+")";
});}};d.monthDay=new RegExp(d.months+" "+d.days);d.dayMonth=new RegExp(d.days+"(?: (?:day )?of)? "+d.months);d.daysOnly=new RegExp(d.days);d.digit=new RegExp("\\b("+e.intToWords.join("|")+")\\b","g");
return{parse:function(p){if(p===null){p="";}var n=b(),h=(typeof Watson!=="undefined")?Watson.preprocess(p):[p,{}],p=h[0],m=h[1],o=p.toLowerCase().split(d.rangeSplitters);
d.rangeSplitters.lastIndex=0;n.setMilliseconds(0);while(!m.startDate){if((h=g(o[0],n,null))!==null){if(h.isAllDay){n.setHours(0,0,0);}m.isAllDay=h.isAllDay;
m.eventTitle=h.eventTitle;m.startDate=h.isValidDate?n:null;}if(!m.startDate&&o.length>=3){var j=[o[0]+o[1]+o[2]];for(var i=3;i<o.length;i++){j.push(o[i]);
}o=j;}else{break;}}while(!m.endDate){if(o.length>1){n=new Date(n.getTime());if((h=g(o[2],n,m))!==null){if(m.isAllDay){n.setHours(0,0,0);}if(h.eventTitle.length>m.eventTitle.length){m.eventTitle=h.eventTitle;
}m.endDate=h.isValidDate?n:null;}}if(!m.endDate){if(o.length>=4){var j=[o[0],o[1],o[2]+o[3]+o[4]];for(var i=5;i<o.length;i++){j.push(o[i]);}o=j;}else{m.endDate=null;
break;}}}if(m.eventTitle){m.eventTitle=m.eventTitle.replace(/(?:^| )(?:\.|!|,|;)+/g,"");var l=p.match(new RegExp(e.escapeRegExp(m.eventTitle),"i"));if(l){m.eventTitle=l[0].replace(/ +/g," ").trim();
if(m.eventTitle==""){m.eventTitle=null;}}}else{m.eventTitle=null;}if(typeof Watson!=="undefined"){Watson.postprocess(m);}return m;},_setNow:function(h){c=h;
}};})();