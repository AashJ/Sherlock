/*!
 * Sherlock
 * Copyright (c) 2012 Tabule, Inc.
 * Version 1.0
 */
var Sherlock=(function(){var a={rangeSplitters:/(\bto\b|\-|\b(?:un)?till?\b|\bthrough|and\b)/g,months:"\\b(jan(?:uary)?|feb(?:ruary)?|mar(?:ch)?|apr(?:il)?|may|jun(?:e)?|jul(?:y)?|aug(?:ust)?|sep(?:tember)?|oct(?:ober)?|nov(?:ember)?|dec(?:ember)?)\\b",days:"\\b([0-3]?\\d)(?:st|nd|rd|th)?,?\\b",shortForm:/\b([0-1]?\d)(?:\/|\.)([0-3]?\d)/,weekdays:/(next (?:week (?:on )?)?)?\b(sun|mon|tue(?:s)?|wed(?:nes)?|thurs|fri|sat(?:ur)?)(?:day)?\b/,relativeDate:/\b(next (?:week|month)|tom(?:orrow)?|tod(?:ay)?|day after tom(?:orrow)?)\b/,inRelativeDate:/\b(\d{1,2}|a) (day|week|month)s?\b/,inRelativeTime:/\b(\d{1,2}|a|an) (hour|min(?:ute)?)s?\b/,midtime:/(?:@ ?)?\b(?:at )?(noon|midnight)\b/,militaryTime:/\b([0-2]\d):?([0-5]\d)\b/,explicitTime:/(?:@ ?)?\b(?:at |from )?([0-1]?\d)(?::([0-5]\d))? ?([ap]\.?m?\.?)?\b/,hoursOnly:/^[0-1]?\d$/,fillerWords:/\b(from|is|at|on|for|in|(?:un)?till?)\b/},d=function(j,h,f){var i={},n=false,l=false,g=b.strToNum(j);
if(n=c.explicitDate(g,h,f)||c.weekday(g,h)||c.relativeDate(g,h)){j=j.replace(new RegExp(b.numToStr(n)),"");}if(l=c.hour(g,h)){var e=new Date();if(h<e){h.setDate(h.getDate()+1);
}else{if(h>e&&f){var m=new Date(h.getTime()),k=new Date(f.startDate.getTime());m.setDate(m.getDate()-1);k.setDate(k.getDate()-1);if(k<e&&m>e){f.startDate=k;
h.setDate(h.getDate()-1);}}}j=j.replace(new RegExp(b.numToStr(l)),"");}i.eventTitle=j.split(a.fillerWords)[0].trim();i.isAllDay=!!(n&&!l);i.isValidDate=!!(n||l||j.match(/\bnow\b/));
return i;},c={hour:function(j,i){var f;if(f=j.match(a.inRelativeTime)){if(isNaN(f[1])){f[1]=1;}switch(f[2]){case"hour":i.setHours(i.getHours()+parseInt(f[1]));
return f[0];case"min":i.setMinutes(i.getMinutes()+parseInt(f[1]));return f[0];case"minute":i.setMinutes(i.getMinutes()+parseInt(f[1]));return f[0];default:break;
}}if(f=j.match(a.midtime)){switch(f[1]){case"noon":i.setHours(12,0,0);return f[0];case"midnight":i.setHours(0,0,0);return f[0];default:break;}}if(f=j.match(a.militaryTime)){i.setHours(f[1],f[2],0);
return f[0];}if(f=j.match(new RegExp(a.explicitTime.source,"g"))){f=f.sort(function(l,k){return k.length-l.length;})[0];if(f.length<=2&&j.trim().length>2){return false;
}f=f.match(a.explicitTime);var e=parseInt(f[1]),h=f[2]||0,g=f[3];if(g){if(g.indexOf("p")===0&&e!=12){e+=12;}else{if(g.indexOf("a")===0&&e==12){e=0;}}}else{if(e<12&&(e<7||e<i.getHours())){e+=12;
}}i.setHours(e,h,0);return f[0];}return false;},explicitDate:function(j,g,f){var h,i,k;if(h=j.match(a.monthDay)){i=b.changeMonth(h[1]);k=h[2];}else{if(h=j.match(a.dayMonth)){i=b.changeMonth(h[2]);
k=h[1];}else{if(h=j.match(a.shortForm)){i=h[1]-1;k=h[2];}else{if(h=j.match(new RegExp(a.days+".?$","g"))){h=h.sort(function(o,n){return n.length-o.length;
})[0];if(!(f&&f.isAllDay)&&h.length<=2&&h.match(a.hoursOnly)){return false;}h=h.match(a.daysOnly);i=g.getMonth();k=h[1];if(k<g.getDate()){i++;}}else{return false;
}}}}g.setMonth(i,k);var e=new Date();if(g<e&&!(g.getMonth()===e.getMonth()&&g.getDate()===e.getDate())){g.setFullYear(g.getFullYear()+1);}else{if(g>e&&f){var m=new Date(g.getTime()),l=new Date(f.startDate.getTime());
m.setFullYear(m.getFullYear()-1);l.setFullYear(l.getFullYear()-1);if(l<e&&m>e){f.startDate=l;g.setFullYear(g.getFullYear()-1);}}}return h[0];},weekday:function(g,f){var e=g.match(a.weekdays);
if(e){switch(e[2].substr(0,3)){case"sun":b.changeDay(f,0,e[1]);return e[0];case"mon":b.changeDay(f,1,e[1]);return e[0];case"tue":b.changeDay(f,2,e[1]);
return e[0];case"wed":b.changeDay(f,3,e[1]);return e[0];case"thu":b.changeDay(f,4,e[1]);return e[0];case"fri":b.changeDay(f,5,e[1]);return e[0];case"sat":b.changeDay(f,6,e[1]);
return e[0];default:break;}}return false;},relativeDate:function(g,f){var e;if(e=g.match(a.relativeDate)){switch(e[1]){case"next week":f.setDate(f.getDate()+7);
return e[0];case"next month":f.setMonth(f.getMonth()+1);return e[0];case"tom":f.setDate(f.getDate()+1);return e[0];case"tomorrow":f.setDate(f.getDate()+1);
return e[0];case"day after tomorrow":f.setDate(f.getDate()+2);return e[0];case"day after tom":f.setDate(f.getDate()+2);return e[0];case"today":return e[0];
case"tod":return e[0];default:break;}}if(e=g.match(a.inRelativeDate)){if(isNaN(e[1])){e[1]=1;}switch(e[2]){case"day":f.setDate(f.getDate()+parseInt(e[1]));
return e[0];case"week":f.setDate(f.getDate()+parseInt(e[1])*7);return e[0];case"month":f.setMonth(f.getMonth()+parseInt(e[1]));return e[0];default:break;
}}return false;}},b={changeMonth:function(e){switch(e.substr(0,3)){case"jan":return 0;case"feb":return 1;case"mar":return 2;case"apr":return 3;case"may":return 4;
case"jun":return 5;case"jul":return 6;case"aug":return 7;case"sep":return 8;case"oct":return 9;case"nov":return 10;case"dec":return 11;default:return null;
}},changeDay:function(h,f,e){var g=7-h.getDay()+f;if(g>7&&!e){g-=7;}h.setDate(h.getDate()+g);},escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");
},wordsToInt:{one:1,first:1,two:2,second:2,three:3,third:3,four:4,fourth:4,five:5,fifth:5,six:6,sixth:6,seven:7,seventh:7,eight:8,eighth:8,nine:9,ninth:9,ten:10,tenth:10},intToWords:["one|first","two|second","three|third","four|fourth","five|fifth","six|sixth","seven|seventh","eight|eighth","nine|ninth","ten|tenth"],strToNum:function(e){return e.replace(a.digit,function(g){var f=b.wordsToInt[g];
if(g.indexOf("th")>0){f+="th";}return f;});},numToStr:function(e){return e.replace(/((?:[1-9]|10)(?:th)?)/g,function(f){return"(?:"+f+"|"+b.intToWords[parseInt(f)-1]+")";
});}};a.monthDay=new RegExp(a.months+" "+a.days);a.dayMonth=new RegExp(a.days+"(?: (?:day )?of)? "+a.months);a.daysOnly=new RegExp(a.days);a.digit=new RegExp("\\b("+b.intToWords.join("|")+")\\b","g");
return{parse:function(m){if(m===null){m="";}var j=new Date(),e=(typeof Watson!=="undefined")?Watson.preprocess(m):[m,{}],m=e[0],i=e[1],l=m.toLowerCase().split(a.rangeSplitters);
a.rangeSplitters.lastIndex=0;j.setMilliseconds(0);while(!i.startDate){if((e=d(l[0],j,null))!==null){if(e.isAllDay){j.setHours(0,0,0);}i.isAllDay=e.isAllDay;
i.eventTitle=e.eventTitle;i.startDate=e.isValidDate?j:null;}if(!i.startDate&&l.length>=3){var g=[l[0]+l[1]+l[2]];for(var f=3;f<l.length;f++){g.push(l[f]);
}l=g;}else{break;}}while(!i.endDate){if(l.length>1){j=new Date(j.getTime());if((e=d(l[2],j,i))!==null){if(i.isAllDay){j.setHours(0,0,0);}if(e.eventTitle.length>i.eventTitle.length){i.eventTitle=e.eventTitle;
}i.endDate=e.isValidDate?j:null;}}if(!i.endDate){if(l.length>=4){var g=[l[0],l[1],l[2]+l[3]+l[4]];for(var f=5;f<l.length;f++){g.push(l[f]);}l=g;}else{i.endDate=null;
break;}}}if(i.eventTitle){i.eventTitle=i.eventTitle.replace(/ (?:\.|!|,|;)+/g,"");var h=m.match(new RegExp(b.escapeRegExp(i.eventTitle),"i"));if(h){i.eventTitle=h[0].replace(/ +/g," ").trim();
}}else{i.eventTitle=null;}if(typeof Watson!=="undefined"){Watson.postprocess(i);}return i;}};})();