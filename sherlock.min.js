/*!
 * Sherlock
 * Copyright (c) 2012 Tabule, Inc.
 * Version 1.0
 */
var Sherlock=(function(){var b={rangeSplitters:/(\bto\b|\-|\b(?:un)?till?\b|\bthrough|and\b)/g,months:"\\b(jan(?:uary)?|feb(?:ruary)?|mar(?:ch)?|apr(?:il)?|may|jun(?:e)?|jul(?:y)?|aug(?:ust)?|sep(?:tember)?|oct(?:ober)?|nov(?:ember)?|dec(?:ember)?)\\b",days:"\\b(0?[1-9]|[1-2]\\d|3[0-1])(?:st|nd|rd|th)?,?\\b",shortForm:/\b(0?[1-9]|1[0-2])(?:\/|\.)(0?[1-9]|[1-2]\d|3[0-1])/,weekdays:/(next (?:week (?:on )?)?)?\b(sun|mon|tue(?:s)?|wed(?:nes)?|thurs|fri|sat(?:ur)?)(?:day)?\b/,relativeDate:/\b(next (?:week|month)|tom(?:orrow)?|tod(?:ay)?|day after tom(?:orrow)?)\b/,inRelativeDate:/\b(\d{1,2}|a) (day|week|month)s?\b/,inRelativeTime:/\b(\d{1,2}|a|an) (hour|min(?:ute)?)s?\b/,midtime:/(?:@ ?)?\b(?:at )?(noon|midnight)\b/,militaryTime:/\b([0-2]\d):?([0-5]\d)\b/,explicitTime:/(?:@ ?)?\b(?:at |from )?(0?[1-9]|1[0-2])(?::([0-5]\d))? ?([ap]\.?m?\.?)?\b/,hoursOnly:/^(0?[1-9]|1[0-2])$/,fillerWords:/\b(from|is|at|on|for|in|(?:un)?till?)\b/},e=function(l,j,i){var h={},f=false,g=false,k=c.strToNum(l);
if(f=d(k,j,i)){l=l.replace(new RegExp(c.numToStr(f)),"");}if(g=a(k,j,i)){l=l.replace(new RegExp(c.numToStr(g)),"");}h.eventTitle=l.split(b.fillerWords)[0].trim();
h.isAllDay=!!(f&&!g);h.isValidDate=!!(f||g||l.match(/\bnow\b/));return h;},a=function(m,i,g){var l;if(l=m.match(b.inRelativeTime)){if(isNaN(l[1])){l[1]=1;
}switch(l[2]){case"hour":i.setHours(i.getHours()+parseInt(l[1]));break;case"min":i.setMinutes(i.getMinutes()+parseInt(l[1]));break;case"minute":i.setMinutes(i.getMinutes()+parseInt(l[1]));
break;default:return false;}}else{if(l=m.match(b.midtime)){switch(l[1]){case"noon":i.setHours(12,0,0);break;case"midnight":i.setHours(0,0,0);break;default:return false;
}}else{if(l=m.match(b.militaryTime)){i.setHours(l[1],l[2],0);}else{if(l=m.match(new RegExp(b.explicitTime.source,"g"))){l=l.sort(function(q,p){return p.length-q.length;
})[0];if(l.length<=2&&m.trim().length>2){return false;}l=l.match(b.explicitTime);var j=parseInt(l[1]),k=l[2]||0,h=l[3];if(h){if(h.indexOf("p")===0&&j!=12){j+=12;
}else{if(h.indexOf("a")===0&&j==12){j=0;}}}else{if(j<12&&(j<7||j<i.getHours())){j+=12;}}i.setHours(j,k,0);}else{return false;}}}}var f=new Date();if(i<f){i.setDate(i.getDate()+1);
}else{if(i>f&&g){var o=new Date(i.getTime()),n=new Date(g.startDate.getTime());o.setDate(o.getDate()-1);n.setDate(n.getDate()-1);if(n<f&&o>f){g.startDate=n;
i.setDate(i.getDate()-1);}}}return l[0];},d=function(k,h,g){var i,j,l;if(i=k.match(b.monthDay)){j=c.changeMonth(i[1]);l=i[2];}else{if(i=k.match(b.dayMonth)){j=c.changeMonth(i[2]);
l=i[1];}else{if(i=k.match(b.weekdays)){switch(i[2].substr(0,3)){case"sun":c.changeDay(h,0,i[1]);return i[0];case"mon":c.changeDay(h,1,i[1]);return i[0];
case"tue":c.changeDay(h,2,i[1]);return i[0];case"wed":c.changeDay(h,3,i[1]);return i[0];case"thu":c.changeDay(h,4,i[1]);return i[0];case"fri":c.changeDay(h,5,i[1]);
return i[0];case"sat":c.changeDay(h,6,i[1]);return i[0];default:return false;}}else{if(i=k.match(b.relativeDate)){switch(i[1]){case"next week":h.setDate(h.getDate()+7);
return i[0];case"next month":h.setMonth(h.getMonth()+1);return i[0];case"tom":h.setDate(h.getDate()+1);return i[0];case"tomorrow":h.setDate(h.getDate()+1);
return i[0];case"day after tomorrow":h.setDate(h.getDate()+2);return i[0];case"day after tom":h.setDate(h.getDate()+2);return i[0];case"today":return i[0];
case"tod":return i[0];default:return false;}}else{if(i=k.match(b.inRelativeDate)){if(isNaN(i[1])){i[1]=1;}switch(i[2]){case"day":h.setDate(h.getDate()+parseInt(i[1]));
return i[0];case"week":h.setDate(h.getDate()+parseInt(i[1])*7);return i[0];case"month":h.setMonth(h.getMonth()+parseInt(i[1]));return i[0];default:return false;
}}else{if(i=k.match(b.shortForm)){j=i[1]-1;l=i[2];}else{if(i=k.match(new RegExp(b.days+".?$","g"))){i=i.sort(function(p,o){return o.length-p.length;})[0];
if(!(g&&g.isAllDay)&&i.length<=2&&i.match(b.hoursOnly)){return false;}i=i.match(b.daysOnly);j=h.getMonth();l=i[1];if(l<h.getDate()){j++;}}else{return false;
}}}}}}}h.setMonth(j,l);var f=new Date();if(h<f&&!(h.getMonth()===f.getMonth()&&h.getDate()===f.getDate())){h.setFullYear(h.getFullYear()+1);}else{if(h>f&&g){var n=new Date(h.getTime()),m=new Date(g.startDate.getTime());
n.setFullYear(n.getFullYear()-1);m.setFullYear(m.getFullYear()-1);if(m<f&&n>f){g.startDate=m;h.setFullYear(h.getFullYear()-1);}}}return i[0];},c={changeMonth:function(f){switch(f.substr(0,3)){case"jan":return 0;
case"feb":return 1;case"mar":return 2;case"apr":return 3;case"may":return 4;case"jun":return 5;case"jul":return 6;case"aug":return 7;case"sep":return 8;
case"oct":return 9;case"nov":return 10;case"dec":return 11;default:return null;}},changeDay:function(i,g,f){var h=7-i.getDay()+g;if(h>7&&!f){h-=7;}i.setDate(i.getDate()+h);
},escapeRegExp:function(f){return f.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");},wordsToInt:{one:1,first:1,two:2,second:2,three:3,third:3,four:4,fourth:4,five:5,fifth:5,six:6,sixth:6,seven:7,seventh:7,eight:8,eighth:8,nine:9,ninth:9,ten:10,tenth:10},intToWords:["one|first","two|second","three|third","four|fourth","five|fifth","six|sixth","seven|seventh","eight|eighth","nine|ninth","ten|tenth"],strToNum:function(f){return f.replace(b.digit,function(h){var g=c.wordsToInt[h];
if(h.indexOf("th")>0){g+="th";}return g;});},numToStr:function(f){return f.replace(/((?:[1-9]|10)(?:th)?)/g,function(g){return"(?:"+g+"|"+c.intToWords[parseInt(g)-1]+")";
});}};b.monthDay=new RegExp(b.months+" "+b.days);b.dayMonth=new RegExp(b.days+"(?: (?:day )?of)? "+b.months);b.daysOnly=new RegExp(b.days);b.digit=new RegExp("\\b("+c.intToWords.join("|")+")\\b","g");
return{parse:function(n){if(n===null){n="";}var l=new Date(),f=(typeof Watson!=="undefined")?Watson.preprocess(n):[n,{}],n=f[0],j=f[1],m=n.toLowerCase().split(b.rangeSplitters);
b.rangeSplitters.lastIndex=0;l.setMilliseconds(0);while(!j.startDate){if((f=e(m[0],l,null))!==null){if(f.isAllDay){l.setHours(0,0,0);}j.isAllDay=f.isAllDay;
j.eventTitle=f.eventTitle;j.startDate=f.isValidDate?l:null;}if(!j.startDate&&m.length>=3){var h=[m[0]+m[1]+m[2]];for(var g=3;g<m.length;g++){h.push(m[g]);
}m=h;}else{break;}}while(!j.endDate){if(m.length>1){l=new Date(l.getTime());if((f=e(m[2],l,j))!==null){if(j.isAllDay){l.setHours(0,0,0);}if(f.eventTitle.length>j.eventTitle.length){j.eventTitle=f.eventTitle;
}j.endDate=f.isValidDate?l:null;}}if(!j.endDate){if(m.length>=4){var h=[m[0],m[1],m[2]+m[3]+m[4]];for(var g=5;g<m.length;g++){h.push(m[g]);}m=h;}else{j.endDate=null;
break;}}}if(j.eventTitle){j.eventTitle=j.eventTitle.replace(/ (?:\.|!|,|;)+/g,"");var i=n.match(new RegExp(c.escapeRegExp(j.eventTitle),"i"));if(i){j.eventTitle=i[0].replace(/ +/g," ").trim();
}}else{j.eventTitle=null;}if(typeof Watson!=="undefined"){Watson.postprocess(j);}return j;}};})();