/*!
 * Sherlock
 * Copyright (c) 2012 Tabule, Inc.
 * Version 1.0
 */
var Sherlock=(function(){var a={rangeSplitters:/(\bto\b|\-|\b(?:un)?till?\b|\bthrough|and\b)/g,digit:/\b(one|first|two|second|three|third|four|five|fifth|six|seven|eight|eighth|nine|ninth|ten)(?:th)?\b/g,months:"\\b(jan(?:uary)?|feb(?:ruary)?|mar(?:ch)?|apr(?:il)?|may|jun(?:e)?|jul(?:y)?|aug(?:ust)?|sep(?:tember)?|oct(?:ober)?|nov(?:ember)?|dec(?:ember)?)\\b",days:"\\b([0-3]?\\d)(?:st|nd|rd|th)?,?\\b",shortForm:/\b([0-1]?\d)(?:\/|\.)([0-3]?\d)/,weekdays:/(next (?:week (?:on )?)?)?\b(sun|mon|tue(?:s)?|wed(?:nes)?|thurs|fri|sat(?:ur)?)(?:day)?\b/,relativeDate:/\b(next (?:week|month)|tom(?:orrow)?|tod(?:ay)?|day after tom(?:orrow)?)\b/,inRelativeDate:/\b(\d{1,2}|a) (day|week|month)s?\b/,inRelativeTime:/\b(\d{1,2}|a|an) (hour|min(?:ute)?)s?\b/,midtime:/(?:@ ?)?\b(?:at )?(noon|midnight)\b/,militaryTime:/\b([0-2]\d):?([0-5]\d)\b/,explicitTime:/(?:@ ?)?\b(?:at |from )?([0-1]?\d)(?::([0-5]\d))? ?([ap]\.?m?\.?)?\b/,hoursOnly:/^[0-1]?\d$/,fillerWords:/\b(from|is|at|on|for|in|(?:un)?till?)\b/},c=function(i,g,e){var h={},m=false,k=false,f=b.strToNum(i);
if(m=b.explicitDate.matcher(f,g,e)||b.weekday.matcher(f,g)||b.relativeDate.matcher(f,g)){i=i.replace(new RegExp(b.numToStr(m)),"");}if(k=b.hour.matcher(f,g)){var d=new Date();
if(g<d){g.setDate(g.getDate()+1);}else{if(g>d&&e){var l=new Date(g.getTime()),j=new Date(e.startDate.getTime());l.setDate(l.getDate()-1);j.setDate(j.getDate()-1);
if(j<d&&l>d){e.startDate=j;g.setDate(g.getDate()-1);}}}i=i.replace(new RegExp(b.numToStr(k)),"");}h.eventTitle=i.split(a.fillerWords)[0].trim();h.isAllDay=!!(m&&!k);
h.isValidDate=!!(m||k||i.match(/\bnow\b/));return h;},b={hour:{matcher:function(i,h){var e;if(e=i.match(a.inRelativeTime)){if(isNaN(e[1])){e[1]=1;}switch(e[2]){case"hour":h.setHours(h.getHours()+parseInt(e[1]));
return e[0];case"min":h.setMinutes(h.getMinutes()+parseInt(e[1]));return e[0];case"minute":h.setMinutes(h.getMinutes()+parseInt(e[1]));return e[0];default:break;
}}if(e=i.match(a.midtime)){switch(e[1]){case"noon":h.setHours(12,0,0);return e[0];case"midnight":h.setHours(0,0,0);return e[0];default:break;}}if(e=i.match(a.militaryTime)){h.setHours(e[1],e[2],0);
return e[0];}if(e=i.match(new RegExp(a.explicitTime.source,"g"))){e=e.sort(function(k,j){return j.length-k.length;})[0];if(e.length<=2&&i.trim().length>2){return false;
}e=e.match(a.explicitTime);var d=parseInt(e[1]),g=e[2]||0,f=e[3];if(f){if(f.indexOf("p")===0&&d!=12){d+=12;}else{if(f.indexOf("a")===0&&d==12){d=0;}}}else{if(d<12&&(d<7||d<h.getHours())){d+=12;
}}h.setHours(d,g,0);return e[0];}return false;}},relativeDate:{matcher:function(f,e){var d;if(d=f.match(a.relativeDate)){switch(d[1]){case"next week":e.setDate(e.getDate()+7);
return d[0];case"next month":e.setMonth(e.getMonth()+1);return d[0];case"tom":e.setDate(e.getDate()+1);return d[0];case"tomorrow":e.setDate(e.getDate()+1);
return d[0];case"day after tomorrow":e.setDate(e.getDate()+2);return d[0];case"day after tom":e.setDate(e.getDate()+2);return d[0];case"today":return d[0];
case"tod":return d[0];default:break;}}if(d=f.match(a.inRelativeDate)){if(isNaN(d[1])){d[1]=1;}switch(d[2]){case"day":e.setDate(e.getDate()+parseInt(d[1]));
return d[0];case"week":e.setDate(e.getDate()+parseInt(d[1])*7);return d[0];case"month":e.setMonth(e.getMonth()+parseInt(d[1]));return d[0];default:break;
}}return false;}},explicitDate:{matcher:function(i,f,e){var g,h,j;if(g=i.match(a.monthDay)){h=this.changeMonth(g[1]);j=g[2];}else{if(g=i.match(a.dayMonth)){h=this.changeMonth(g[2]);
j=g[1];}else{if(g=i.match(a.shortForm)){h=g[1]-1;j=g[2];}else{if(g=i.match(new RegExp(a.days+".?$","g"))){g=g.sort(function(n,m){return m.length-n.length;
})[0];if(!(e&&e.isAllDay)&&g.length<=2&&g.match(a.hoursOnly)){return false;}g=g.match(a.daysOnly);h=f.getMonth();j=g[1];if(j<f.getDate()){h++;}}else{return false;
}}}}f.setMonth(h,j);var d=new Date();if(f<d&&!(f.getMonth()===d.getMonth()&&f.getDate()===d.getDate())){f.setFullYear(f.getFullYear()+1);}else{if(f>d&&e){var l=new Date(f.getTime()),k=new Date(e.startDate.getTime());
l.setFullYear(l.getFullYear()-1);k.setFullYear(k.getFullYear()-1);if(k<d&&l>d){e.startDate=k;f.setFullYear(f.getFullYear()-1);}}}return g[0];},changeMonth:function(d){switch(d.substr(0,3)){case"jan":return 0;
case"feb":return 1;case"mar":return 2;case"apr":return 3;case"may":return 4;case"jun":return 5;case"jul":return 6;case"aug":return 7;case"sep":return 8;
case"oct":return 9;case"nov":return 10;case"dec":return 11;default:return null;}}},weekday:{matcher:function(f,e){var d=f.match(a.weekdays);if(d){switch(d[2].substr(0,3)){case"sun":this.changeDay(e,0,d[1]);
return d[0];case"mon":this.changeDay(e,1,d[1]);return d[0];case"tue":this.changeDay(e,2,d[1]);return d[0];case"wed":this.changeDay(e,3,d[1]);return d[0];
case"thu":this.changeDay(e,4,d[1]);return d[0];case"fri":this.changeDay(e,5,d[1]);return d[0];case"sat":this.changeDay(e,6,d[1]);return d[0];default:break;
}}return false;},changeDay:function(g,e,d){var f=7-g.getDay()+e;if(f>7&&!d){f-=7;}g.setDate(g.getDate()+f);}},escapeRegExp:function(d){return d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");
},wordsToInt:{one:1,first:1,two:2,second:2,three:3,third:3,four:4,fourth:4,five:5,fifth:5,six:6,sixth:6,seven:7,seventh:7,eight:8,eighth:8,nine:9,ninth:9,ten:10,tenth:10},intToWords:["one|first","two|second","three|third","four|fourth","five|fifth","six|sixth","seven|seventh","eight|eighth","nine|ninth","ten|tenth"],strToNum:function(d){return d.replace(a.digit,function(f){var e=b.wordsToInt[f];
if(f.indexOf("th")>0){e+="th";}return e;});},numToStr:function(d){return d.replace(/((?:[1-9]|10)(?:th)?)/g,function(e){return"(?:"+e+"|"+b.intToWords[parseInt(e)-1]+")";
});}};a.monthDay=new RegExp(a.months+" "+a.days);a.dayMonth=new RegExp(a.days+"(?: (?:day )?of)? "+a.months);a.daysOnly=new RegExp(a.days);return{parse:function(l){if(l===null){l="";
}var i=new Date(),d=(typeof Watson!=="undefined")?Watson.preprocess(l):[l,{}],l=d[0],h=d[1],j=l.toLowerCase().split(a.rangeSplitters);a.rangeSplitters.lastIndex=0;
i.setMilliseconds(0);while(!h.startDate){if((d=c(j[0],i,null))!==null){if(d.isAllDay){i.setHours(0,0,0);}h.isAllDay=d.isAllDay;h.eventTitle=d.eventTitle;
h.startDate=d.isValidDate?i:null;}if(!h.startDate&&j.length>=3){var f=[j[0]+j[1]+j[2]];for(var e=3;e<j.length;e++){f.push(j[e]);}j=f;}else{break;}}while(!h.endDate){if(j.length>1){i=new Date(i.getTime());
if((d=c(j[2],i,h))!==null){if(h.isAllDay){i.setHours(0,0,0);}if(d.eventTitle.length>h.eventTitle.length){h.eventTitle=d.eventTitle;}h.endDate=d.isValidDate?i:null;
}}if(!h.endDate){if(j.length>=4){var f=[j[0],j[1],j[2]+j[3]+j[4]];for(var e=5;e<j.length;e++){f.push(j[e]);}j=f;}else{h.endDate=null;break;}}}if(h.eventTitle){h.eventTitle=h.eventTitle.replace(/ (?:\.|!|,|;)+/g,"");
var g=l.match(new RegExp(b.escapeRegExp(h.eventTitle),"i"));if(g){h.eventTitle=g[0].replace(/ +/g," ").trim();}}else{h.eventTitle=null;}if(typeof Watson!=="undefined"){Watson.postprocess(h);
}return h;}};})();